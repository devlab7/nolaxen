Sub miseEnForme()
'
' Macro1 Macro
'

'

h = 1
While Len(Cells(h, 1).Value) = 0
    
    h = h + 1
Wend

firstRow = h


i = firstRow

While Len(Cells(i, 1).Value) > 0
    
    i = i + 1
Wend
lastRow0 = i - 1
col = 5
lastCol = 21 * 60 + 5
firstHour = 5
currentHour = firstHour




While col < lastCol

    'MsgBox (col)
    minute0 = col - 5
    
    Range(Cells(firstRow, col), Cells(lastRow0, col)).Select
    'each colum
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThick
    End With
    
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThick
    End With
    
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlDash
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlHairline
    End With
    
    
    '60 minutes
    If minute0 Mod 60 = 0 Then
    
    
        With Selection.Borders(xlEdgeLeft)
            .LineStyle = xlContinuous
            .ColorIndex = xlAutomatic
            .TintAndShade = 0
            .Weight = xlThick
        End With
        
    If currentHour < 10 Or currentHour > 23 Then
        hour0 = "0"
        
    
    Else
        hour0 = ""
    End If
    Cells(firstRow - 2, col - 1).Value = hour0 & currentHour Mod 24 & "h00"
    
    
    Range(Cells(firstRow - 2, col - 2), Cells(firstRow - 2, col + 1)).Select
    Selection.Merge
    ElseIf minute0 Mod 15 = 0 Then
    '15 minutes
        With Selection.Borders(xlEdgeLeft)
            .LineStyle = xlContinuous
            .ColorIndex = xlAutomatic
            .TintAndShade = 0
            .Weight = xlMedium
        End With
        If minute0 Mod 60 <> 0 Then
            Cells(firstRow - 2, col - 1).Value = hour0 & currentHour Mod 24 & "h" & minute0 Mod 60
            Range(Cells(firstRow - 2, col - 2), Cells(firstRow - 2, col + 1)).Select
            Selection.Merge
        End If
    ElseIf minute0 Mod 5 = 0 Then
    
    '5 minutes
        With Selection.Borders(xlEdgeLeft)
            .LineStyle = xlContinuous
            .ColorIndex = xlAutomatic
            .TintAndShade = 0
            .Weight = xlThin
        End With
        If minute0 Mod 60 <> 0 Then
             If minute0 Mod 60 = 5 Then
                 Cells(firstRow - 2, col - 1).Value = hour0 & currentHour Mod 24 & "h0" & minute0 Mod 60
            Else
                 Cells(firstRow - 2, col - 1).Value = hour0 & currentHour Mod 24 & "h" & minute0 Mod 60
            End If
            
            Range(Cells(firstRow - 2, col - 2), Cells(firstRow - 2, col + 1)).Select
             Selection.Merge
                
        End If
        
        If minute0 Mod 60 = 55 Then
            currentHour = currentHour + 1
        
        End If
        
    Else
    
        With Selection.Borders(xlEdgeLeft)
            .LineStyle = xlDot
            .ColorIndex = xlAutomatic
            .TintAndShade = 0
            .Weight = xlThin
        End With
    End If
    col = col + 1
    
    
    

Wend
Cells(firstRow - 2, col - 1).Value = hour0 & currentHour Mod 24 & "h00"
Range(Cells(2, lastCol), Cells(lastRow0, lastCol)).Select
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThick
    End With

Range(Columns(2), Columns(lastCol)).ColumnWidth = 1

Cells(5, 5).Select
ActiveWindow.FreezePanes = True
    
End Sub

Sub heightRow()
'
' heightRow Macro
'

'
    column0 = "B"
    firstRow = 4
    lastRow = firstRow
    Do While Not IsEmpty(Range(column0 & lastRow))
        lastRow = lastRow + 1
    Loop
    lastRow = lastRow - 1
    
    currentRow = 4
    While currentRow <= lastRow
        'heightRow0 = Cells(currentRow, 1).Value
        'MsgBox (heightRow0)
        Rows(currentRow & ":" & currentRow).Select
        Selection.RowHeight = Cells(currentRow, 1).Value * 20
        currentRow = currentRow + 1
    Wend
        
    
    
    
    
End Sub



Sub graphicageAller()

'delete all lines


Sheets("Aller").Activate

i = 2

While Len(Cells(1, i).Value) > 0

    i = i + 1

Wend

lastCol = i - 1
currentCol = 2

startHour = 5
While currentCol <= lastCol
    Sheets("Aller").Activate
    currentStationRow = 2
    
    j = 100
    
    While Len(Cells(j, currentCol).Value) = 0
        j = j - 1
    
    Wend
    
    'MsgBox ("currentCol = " & currentCol)
    
    
    lastStationRow = j - 1
    arrivalStationRow = 2
    While currentStationRow <= lastStationRow
        'MsgBox ("currentStationRow = " & currentStationRow)
        Sheets("Aller").Activate

        currentStationRowStartStation = currentStationRow
        Do While currentStationRowStartStation <= lastStationRow
            If Cells(currentStationRowStartStation, currentCol).Value <> 0 Then
                startStation = Cells(currentStationRowStartStation, 1).Value
                startTime = Cells(currentStationRowStartStation, currentCol).Value
                Exit Do
            End If
            currentStationRowStartStation = currentStationRowStartStation + 1
        Loop
        
        
        'MsgBox ("startStation = " & startStation)
        'MsgBox ("arrivalStation = " & arrivalStation)
        
        Sheets("Graphicage").Activate
        Cells.Find(What:=startStation, After:=Cells(arrivalStationRow - 1, 1), LookIn:=xlFormulas2, _
            LookAt:=xlWhole, SearchOrder:=xlByColumns, SearchDirection:=xlNext, _
            MatchCase:=False, SearchFormat:=False).Activate
            startStationRow = ActiveCell.Row
            startStationRowHeight = Range(Cells(1, 1), Cells(startStationRow, 1)).Height
        
        Sheets("Aller").Activate
        
        currentStationRowArrivalStation = currentStationRow
        Do While currentStationRowArrivalStation <= lastStationRow
            If Cells(currentStationRowArrivalStation + 1, currentCol).Value <> 0 Then
                arrivalStation = Cells(currentStationRowArrivalStation + 1, 1).Value
                arrivalTime = Cells(currentStationRowArrivalStation + 1, currentCol).Value
                Exit Do
            End If
            
            currentStationRowArrivalStation = currentStationRowArrivalStation + 1
        Loop
        
        Sheets("Graphicage").Activate
        'MsgBox ("startStationRow = " & startStationRow)
        Cells.Find(What:=arrivalStation, After:=Cells(startStationRow, 1), LookIn:=xlFormulas2, _
            LookAt:=xlWhole, SearchOrder:=xlByColumns, SearchDirection:=xlNext, _
            MatchCase:=False, SearchFormat:=False).Activate
            arrivalStationRow = ActiveCell.Row
            arrivalStationRowHeight = Range(Cells(1, 1), Cells(arrivalStationRow, 1)).Height
        
        
        startTimeCol = ((startTime * 24) - startHour) * 60 + 4
        'MsgBox ("startTime = " & startTime)
        arrivalTimeCol = ((arrivalTime * 24) - startHour) * 60 + 4
       
        startTimeWidth = Range(Cells(1, 1), Cells(1, startTimeCol)).Width
        arrivalTimeWidth = Range(Cells(1, 1), Cells(1, arrivalTimeCol)).Width
        'MsgBox ("startTimeCol = " & startTimeCol)
        
        '
        'MsgBox ("startStationRowHeight = " & startStationRowHeight)
        'MsgBox ("arrivalStationRowHeight = " & arrivalStationRowHeight)
        
        'ActiveSheet.Shapes.AddLine 0, 100, startTimeWidth, startStationRowHeight
        
        'ActiveSheet.Shapes.AddLine startTimeWidth, startStationRowHeight, arrivalTimeWidth, arrivalStationRowHeight
        ActiveSheet.Shapes.AddLine _
            (startTimeWidth, startStationRowHeight, arrivalTimeWidth, arrivalStationRowHeight).Select
            
        With Selection.ShapeRange.Line
            .Visible = msoTrue
            .ForeColor.RGB = RGB(255, 0, 255)
            .Transparency = 0
        End With
        'ActiveSheet.Shapes.AddConnector(msoConnectorStraight, startTimeWidth, startStationRowHeight, _
        'arrivalTimeWidth, arrivalStationRowHeight).Select
        
        
        currentStationRow = currentStationRow + 1
        
    Wend
    
    

    currentCol = currentCol + 1
Wend



End Sub


Sub graphicageRetour()

'delete all lines


Sheets("Retour").Activate

i = 2

While Len(Cells(1, i).Value) > 0

    i = i + 1

Wend

lastCol = i - 1
currentCol = 2

startHour = 5
While currentCol <= lastCol
    Sheets("Retour").Activate
    currentStationRow = 2
    
    j = 100
    
    While Len(Cells(j, currentCol).Value) = 0
        j = j - 1
    
    Wend
    
    'MsgBox ("currentCol = " & currentCol)
    
    
    lastStationRow = j - 1
    arrivalStationRow = 100
    While currentStationRow <= lastStationRow
        'MsgBox ("currentStationRow = " & currentStationRow)
        Sheets("Retour").Activate

        currentStationRowStartStation = currentStationRow
        Do While currentStationRowStartStation <= lastStationRow
            If Cells(currentStationRowStartStation, currentCol).Value <> 0 Then
                startStation = Cells(currentStationRowStartStation, 1).Value
                startTime = Cells(currentStationRowStartStation, currentCol).Value
                Exit Do
            End If
            currentStationRowStartStation = currentStationRowStartStation + 1
        Loop
        
        
        'MsgBox ("startStation = " & startStation)
        'MsgBox ("arrivalStation = " & arrivalStation)
        
        Sheets("Graphicage").Activate
        Cells.Find(What:=startStation, After:=Cells(arrivalStationRow - 1, 1), LookIn:=xlFormulas2, _
            LookAt:=xlWhole, SearchOrder:=xlByColumns, SearchDirection:=xlPrevious, _
            MatchCase:=False, SearchFormat:=False).Activate
            startStationRow = ActiveCell.Row
            startStationRowHeight = Range(Cells(1, 1), Cells(startStationRow, 1)).Height
        
        Sheets("Retour").Activate
        
        currentStationRowArrivalStation = currentStationRow
        Do While currentStationRowArrivalStation <= lastStationRow
            If Cells(currentStationRowArrivalStation + 1, currentCol).Value <> 0 Then
                arrivalStation = Cells(currentStationRowArrivalStation + 1, 1).Value
                arrivalTime = Cells(currentStationRowArrivalStation + 1, currentCol).Value
                Exit Do
            End If
            
            currentStationRowArrivalStation = currentStationRowArrivalStation + 1
        Loop
        
        Sheets("Graphicage").Activate
        'MsgBox ("startStationRow = " & startStationRow)
        Cells.Find(What:=arrivalStation, After:=Cells(startStationRow - 1, 1), LookIn:=xlFormulas2, _
            LookAt:=xlWhole, SearchOrder:=xlByColumns, SearchDirection:=xlPrevious, _
            MatchCase:=False, SearchFormat:=False).Activate
            arrivalStationRow = ActiveCell.Row
            arrivalStationRowHeight = Range(Cells(1, 1), Cells(arrivalStationRow, 1)).Height
        
        
        startTimeCol = ((startTime * 24) - startHour) * 60 + 4
        'MsgBox ("startTime = " & startTime)
        arrivalTimeCol = ((arrivalTime * 24) - startHour) * 60 + 4
       
        startTimeWidth = Range(Cells(1, 1), Cells(1, startTimeCol)).Width
        arrivalTimeWidth = Range(Cells(1, 1), Cells(1, arrivalTimeCol)).Width
        'MsgBox ("startTimeCol = " & startTimeCol)
        
        '
        'MsgBox ("startStationRowHeight = " & startStationRowHeight)
        'MsgBox ("arrivalStationRowHeight = " & arrivalStationRowHeight)
        
        'ActiveSheet.Shapes.AddLine 0, 100, startTimeWidth, startStationRowHeight
        
        'ActiveSheet.Shapes.AddLine startTimeWidth, startStationRowHeight, arrivalTimeWidth, arrivalStationRowHeight
        ActiveSheet.Shapes.AddLine _
            (startTimeWidth, startStationRowHeight, arrivalTimeWidth, arrivalStationRowHeight).Select
            
        With Selection.ShapeRange.Line
            .Visible = msoTrue
            .ForeColor.RGB = RGB(255, 0, 255)
            .Transparency = 0
        End With
        'ActiveSheet.Shapes.AddConnector(msoConnectorStraight, startTimeWidth, startStationRowHeight, _
        'arrivalTimeWidth, arrivalStationRowHeight).Select
        
        
        currentStationRow = currentStationRow + 1
        
    Wend
    
    

    currentCol = currentCol + 1
Wend



End Sub
